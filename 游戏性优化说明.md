# 游戏性优化说明 v2.1

## 概述
本次优化主要针对用户界面和游戏机制进行了5项重要改进，提升了游戏的可玩性和用户体验。

## 🎯 优化内容

### 1. 商品分类重命名
**改进前**：
- 正规商品 / 灰色商品

**改进后**：
- 坊市 / 黑市

**影响范围**：
- 主界面标签页名称
- 教程说明文档
- 游戏术语统一

**用户体验提升**：
- 更符合古代商业背景
- 术语更加生动形象
- 增强游戏沉浸感

### 2. 背包成本显示优化
**改进前**：
```
丝绸 x 3
成本: ¥1500
```

**改进后**：
```
丝绸 x 3
单价成本: ¥500 | 总成本: ¥1500
```

**技术实现**：
- 新增 `unitCost` 属性记录单价成本
- 显示格式：单价成本 + 总成本
- 自动兼容旧存档数据

**用户体验提升**：
- 更清晰的成本信息
- 便于计算利润率
- 帮助制定交易策略

### 3. 不同成本商品分开显示
**改进前**：
- 相同商品合并显示，无论购买价格

**改进后**：
- 不同购买价格的同种商品分开列出
- 卖出时优先卖出成本最低的商品

**技术实现**：
```javascript
// 查找相同价格的同类商品
const existingItem = gameState.inventory.find(item => 
    item.id === id && item.unitCost === price
);
```

**用户体验提升**：
- 精确的库存管理
- 优化的利润计算
- 更好的投资决策支持

### 4. 市场商品显示优化
**改进前**：
```
丝绸
¥800
[买入] [卖出]
```

**改进后**：
```
丝绸                    ¥800
[买入] [卖出]
```

**技术实现**：
- 新增 `.goods-header` 布局
- 使用 `flex` 布局，`justify-content: space-between`
- 字体大小从 16px 增加到 18px

**CSS样式**：
```css
.goods-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 5px;
}

.goods-name, .goods-price {
    font-size: 18px;
}
```

**用户体验提升**：
- 更清晰的价格显示
- 更好的视觉层次
- 提高信息扫描效率

### 5. 随机事件机制优化
**改进前**：
- 随机事件可能在任何时候触发
- 买入黑市商品时触发风险事件

**改进后**：
- 随机事件只在每天开始时触发
- 移除交易时的即时风险事件

**技术实现**：
```javascript
// 每日事件触发函数
function triggerDailyEvent() {
    if (Math.random() < 0.35) { // 35%概率触发事件
        // 延迟显示，让玩家先看到新的一天开始
        setTimeout(() => {
            event.effect();
        }, 1000);
    }
}
```

**用户体验提升**：
- 更有规律的事件节奏
- 减少交易时的意外干扰
- 增强每日开始的仪式感

## 🔧 技术细节

### 数据结构变化
```javascript
// 库存项目新增字段
{
    id: 'silk',
    name: '丝绸',
    type: 'regular',
    quantity: 3,
    totalCost: 1500,
    unitCost: 500,  // 新增：单价成本
    risk: 0
}
```

### 兼容性处理
- 自动为旧存档数据添加 `unitCost` 字段
- 保持向后兼容性
- 平滑升级用户数据

### 性能优化
- 优化库存查找算法
- 减少DOM操作频率
- 改进事件触发机制

## 📊 预期效果

### 游戏平衡性
- ✅ 更精确的成本控制
- ✅ 更合理的事件分布
- ✅ 更清晰的信息展示

### 用户体验
- ✅ 更直观的界面设计
- ✅ 更流畅的操作体验
- ✅ 更沉浸的游戏氛围

### 策略深度
- ✅ 更复杂的库存管理
- ✅ 更精细的利润计算
- ✅ 更多样的交易策略

## 🎮 玩家指南

### 新的交易策略
1. **成本分层管理**：不同价格购入的商品分开管理
2. **利润最大化**：优先卖出低成本商品
3. **风险控制**：关注每日事件对市场的影响

### 界面使用技巧
1. **背包查看**：单价成本帮助快速计算利润率
2. **市场浏览**：更大的字体提高信息获取效率
3. **事件应对**：每日开始留意可能的随机事件

## 🔄 后续优化方向

1. **数据统计**：添加交易历史和利润统计
2. **市场分析**：提供价格趋势图表
3. **成就系统**：基于交易表现的成就奖励
4. **难度调节**：根据玩家水平动态调整事件概率

---

*本次优化显著提升了游戏的策略深度和用户体验，为玩家提供了更精细的商业模拟体验。* 